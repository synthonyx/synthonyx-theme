{{/* 
  Figure Shortcode - General-purpose image with optional caption
  Supports page resources (bundled images) and static files
  
  Usage:
    {{< figure src="image.jpg" alt="Alt text" >}}
    {{< figure src="image.jpg" alt="Alt" caption="Figure caption" >}}
    {{< figure src="/img/logo.png" alt="Logo" class="w-full" loading="lazy" >}}
  
  Parameters:
    src        - Image path (page resource or static path)
    alt        - Alt text (required for accessibility)
    caption    - Optional caption text
    class      - Additional CSS classes for the image
    loading    - Loading attribute: "lazy" (default) or "eager"
    width      - Optional width
    height     - Optional height
*/}}

{{- $src := .Get "src" -}}
{{- $alt := .Get "alt" | default "Image" -}}
{{- $caption := .Get "caption" -}}
{{- $class := .Get "class" | default "" -}}
{{- $loading := .Get "loading" | default "lazy" -}}
{{- $width := .Get "width" -}}
{{- $height := .Get "height" -}}

{{/* Resolve image source - check page resources first, then static */}}
{{- $image := "" -}}
{{- if and (not (hasPrefix $src "/")) .Page.File -}}
  {{/* Try page bundle first */}}
  {{- $image = .Page.Resources.Get $src -}}
{{- end -}}

{{- if $image -}}
  {{/* Page resource found */}}
  <figure class="not-prose my-8">
    <img 
      src="{{ $image.RelPermalink }}" 
      alt="{{ $alt }}"
      {{ with $width }}width="{{ . }}"{{ end }}
      {{ with $height }}height="{{ . }}"{{ end }}
      loading="{{ $loading }}"
      class="w-full border border-white/10 {{ $class }}"
    />
    {{ with $caption }}
    <figcaption class="mt-3 text-sm font-mono text-gray-500 text-center">
      {{ . }}
    </figcaption>
    {{ end }}
  </figure>
{{- else -}}
  {{/* Static file or external URL */}}
  <figure class="not-prose my-8">
    <img 
      src="{{ $src }}" 
      alt="{{ $alt }}"
      {{ with $width }}width="{{ . }}"{{ end }}
      {{ with $height }}height="{{ . }}"{{ end }}
      loading="{{ $loading }}"
      class="w-full border border-white/10 {{ $class }}"
    />
    {{ with $caption }}
    <figcaption class="mt-3 text-sm font-mono text-gray-500 text-center">
      {{ . }}
    </figcaption>
    {{ end }}
  </figure>
{{- end -}}
